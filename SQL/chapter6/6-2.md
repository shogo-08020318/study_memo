# 述語
今までに使ってきた、`=`、`<`、`>`、`<>`などの比較演算子は、正確には比較述語という述語の一種。
述語とは、平たく言うと関数の一種。
ただし、特別な条件を満たす関数となる。
その条件とは、「**戻り値が真理値になること**」。
普通の関数は、戻り値が数値だったり文字列だったりするが、述語の戻り値はすべて真理値（TRUE、FALSE、UNKNOWN）である。


### LIKE述語---文字列の部分一致検索
これまで、文字列を条件にするケースでは「**=**」を使ってきたが、この「=」は、文字列が完全に一致する場合にしかTRUEにならない。
一方、**LIKE述語**はもう少しあいまいで、文字列の**部分一致検索**を行うときに使う。
部分一致には、「前方一致」「中間一致」「後方一致」の３種類ある。

試すためにテーブルを作る。
```sql
CREATE TABLE SampleLike
( strcol VARCHAR(6) NOT NULL,
  PRIMARY KEY (strcol));
CREATE TABLE
```
データの挿入
```sql
BEGIN TRANSACTION;

INSERT INTO SampleLike (strcol) VALUES ('abcddd');
INSERT INTO SampleLike (strcol) VALUES ('dddabc');
INSERT INTO SampleLike (strcol) VALUES ('abdddc');
INSERT INTO SampleLike (strcol) VALUES ('abcdd');
INSERT INTO SampleLike (strcol) VALUES ('ddabc');
INSERT INTO SampleLike (strcol) VALUES ('abddc');

COMMIT;
BEGIN
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
COMMIT
```
確認
```sql
SELECT * FROM SampleLike;
 strcol 
--------
 abcddd
 dddabc
 abdddc
 abcdd
 ddabc
 abddc
(6 rows)
```

このテーブルの中から文字列「ddd」を含むレコードを選択するとき、前方、中間、後方では以下のようになる。

**前方一致：「dddabc」が選択される**
検索条件が、検索対象の文字列の最初に位置しているレコードだけが選択される。
```sql
SELECT *
  FROM SampleLike
 WHERE strcol LIKE 'ddd%';
 strcol 
--------
 dddabc
(1 row)
```
「**%**」は、「０文字以上の任意の文字列」を意味する特殊な記号で、この場合だと「dddではじまるすべての文字列」を意味する。
このように、**LIKE**を使うとパターンマッチングを記述することが可能になる。

**中間一致：「adcddd」「dddabc」「abdddc」が選択される**
検索条件となる文字列が検索対象の文字列の「どこか」に含まれていればレコードが選択される。
```sql
SELECT *
  FROM SampleLike
 WHERE strcol LIKE '%ddd%';
 strcol 
--------
 abcddd
 dddabc
 abdddc
(3 rows)
```
文字列の最初と最後を「**%**」で囲むことで、「文字列のどこかに**ddd**がある文字列」を表現している。

**後方一致：「abcddd」が選択される**
検索条件となる文字列が文字列の最後尾にあるレコードだけが選択される。
```sql
SELECT *
  FROM SampleLike
 WHERE strcol LIKE '%ddd';
 strcol 
--------
 abcddd
(1 row)
```
これは前方一致と逆になる。

「%」に代わりに「**_**」を使うこともできるが、これは**%**と違い、「任意の１文字」を意味する。
使ってみる。
```sql
SELECT *
  FROM SampleLike
 WHERE strcol LIKE 'abc__';
 strcol 
--------
 abcdd
(1 row)
```
「abc」ではじまる文字列としては、「abcddd」もそうだが、「ddd」が３文字のため「__」という2文字分を指定する条件に一致しない。
以下のようにすれば、「abcddd」を選択することができる。
```sql
SELECT *
  FROM SampleLike
 WHERE strcol LIKE 'abc___';
 strcol 
--------
 abcddd
(1 row)
```

### BETWEEN述語---範囲検索
この関数が他の述語や関数と変わっているところは、引数を3つ使うところ。
たとえば、`shohin`テーブルから販売単価が100円から1000円までの商品を選択する場合、以下のように書く。
```sql
SELECT shohin_mei, hanbai_tanka
  FROM Shohin
 WHERE hanbai_tanka BETWEEN 100 AND 1000;
  shohin_mei  | hanbai_tanka 
--------------+--------------
 Tシャツ      |         1000
 穴あけパンチ |          500
 フォーク     |          500
 おろしがね   |          880
 ボールペン   |          100
(5 rows)
```
BETWEENの特徴は、100と1000という両端の値も含むこと。
もし、両端の値を含みたくない場合は、`<`、`>`を使って書く。
```sql
SELECT shohin_mei, hanbai_tanka
  FROM Shohin
 WHERE hanbai_tanka > 100 
   AND hanbai_tanka < 1000;
  shohin_mei  | hanbai_tanka 
--------------+--------------
 穴あけパンチ |          500
 フォーク     |          500
 おろしがね   |          880
(3 rows)
```

### IS NULL、 IS NOT NULL---NULLか非NULLかの判定
NULLかどうかを判定するには**IS NULL**を使う。
```sql
SELECT shohin_mei, shiire_tanka
  FROM Shohin
 WHERE shiire_tanka IS NULL;
 shohin_mei | shiire_tanka 
------------+--------------
 フォーク   |             
 ボールペン |             
(2 rows)
```
NULL以外の行を選択したければ、**IS NOT NULL**を使う。
```sql
SELECT shohin_mei, shiire_tanka
  FROM Shohin
 WHERE shiire_tanka IS NOT NULL;
   shohin_mei   | shiire_tanka 
----------------+--------------
 Tシャツ        |          500
 穴あけパンチ   |          320
 カッターシャツ |         2800
 包丁           |         2800
 圧力鍋         |         5000
 おろしがね     |          790
(6 rows)
```



